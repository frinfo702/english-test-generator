/**
 * Questions loader â€” fetches pre-generated JSON problem files from public/questions/.
 *
 * Problem files are generated by AI (Claude Code / Claude agent) and saved as JSON.
 * The frontend only reads these files; no network/API calls to AI are made at runtime.
 *
 * Directory structure (under public/questions/):
 *   toefl/reading/complete-words/      *.json
 *   toefl/reading/daily-life/          *.json
 *   toefl/reading/academic/            *.json
 *   toefl/writing/build-sentence/      *.json
 *   toefl/writing/email/               *.json
 *   toefl/writing/discussion/          *.json
 *   toefl/speaking/listen-repeat/      *.json
 *   toefl/speaking/interview/          *.json
 *   toeic/part5/                       *.json
 *   toeic/part6/                       *.json
 *   toeic/part7/                       *.json
 *
 * Each directory has an index.json listing available files:
 *   { "files": ["001.json", "002.json", ...] }
 */

export interface QuestionIndex {
  files: string[];
}

export async function fetchQuestionIndex(taskPath: string): Promise<QuestionIndex> {
  const res = await fetch(`/questions/${taskPath}/index.json`);
  if (!res.ok) throw new Error(`No questions found for ${taskPath}. Generate some first!`);
  return res.json();
}

export async function fetchRandomQuestion<T>(taskPath: string): Promise<T> {
  const index = await fetchQuestionIndex(taskPath);
  if (index.files.length === 0) {
    throw new Error(`No question files in ${taskPath}. Generate some first!`);
  }
  const file = index.files[Math.floor(Math.random() * index.files.length)];
  const res = await fetch(`/questions/${taskPath}/${file}`);
  if (!res.ok) throw new Error(`Failed to load question file: ${file}`);
  return res.json();
}

export async function fetchAllQuestions<T>(taskPath: string): Promise<T[]> {
  const index = await fetchQuestionIndex(taskPath);
  const results = await Promise.all(
    index.files.map(async (file) => {
      const res = await fetch(`/questions/${taskPath}/${file}`);
      if (!res.ok) throw new Error(`Failed to load: ${file}`);
      return res.json() as Promise<T>;
    })
  );
  return results;
}
